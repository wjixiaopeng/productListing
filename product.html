<!DOCTYPE html>
<html>
<body>

<h2>Prodcut Search System</h2>

<hr>

<form>
  Add:<br>
  <input type="text" name="produceName" id="apName">
  <button type="button" 
  onclick="addProduct(document.getElementById('apName').value)">Add
  </button>
</form>
<br>
<form>
  Search:<br>
  <input type="text" name="produceName" id="spName">
  <button type="button" 
  onclick="searchProduct(document.getElementById('spName').value)">Search
  </button>
</form>

<h2> Result:</h2>
<table id="table">
  
</table>

<script>
  function searchProduct(name) {
    // empty input!
    if (name.length == 0) {
      var txt = "<table border='1'><tr><td>";
      txt += "empty input!";
      txt += "</td></tr></table>";
      document.getElementById("table").innerHTML = txt;
      return;
    }
    var url = "http://localhost:8080/?name=" + name;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        // var table = document.getElementById("table");
        products = JSON.parse(this.responseText);   // not json
        // products = this.responseText;
        if (Object.keys(products).length == 0) { // not found any product
          var txt = "<table border='1'><tr><td>";
          txt += "not found!";
          txt += "</td></tr></table>";
          document.getElementById("table").innerHTML = txt;
        } else {
          // console.log(products);
          var txt = "<table border='1'>";
          for (i in products) {
              console.log(products[i]);
              txt += "<tr><td>" + products[i].name + "</td></tr>";
          }
          txt += "</table>"        
          document.getElementById("table").innerHTML = txt;
        }
      }
    };
    xhttp.open("GET", url, true);
    xhttp.send();
  };
  function addProduct(name) {
    // empty input!
    if (name.length == 0) {
      var txt = "<table border='1'><tr><td>";
      txt += "empty input!";
      txt += "</td></tr></table>";
      document.getElementById("table").innerHTML = txt;
      return;
    }
    var url = "http://localhost:8080/?name=" + name;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var txt = "<table border='1'><tr><td>";
          txt += this.responseText;
          txt += "</td></tr></table>";
          document.getElementById("table").innerHTML = txt;
        }
    }
    xhttp.open("POST", url, true);
    xhttp.send();
  };
</script>>

<hr>

</body>
</html>

